# 20240428

小结  

<a id="top"></a>
根据[ego模型时间接口](https://gitee.com/hyg/blog/blob/master/timeflow.md)，今天绑定模版1。

| 时间片 | 时长 | 用途 | 手稿 |
| --- | --- | --- | --- |
| 04:00~04:14 | 15 | 休整 |  |
| 04:15~05:14 | 60 | 备餐、运动 |  |
| 05:15~05:59 | 45 | 早餐 |  |
| 06:00~06:44 | 45 | 会议、自习 |  |
| 06:45~07:44 | 60 | 休整 |  |
| 07:45~08:44 | 60 | 静默工作 | [月份总结报告](#20240428074500) |
| 08:45~09:29 | 45 | 休整 |  |
| 09:30~10:59 | 90 | 静默工作 | [试用term新结构，根据问题更新设计。](#20240428093000) |
| 11:00~13:59 | 180 | 备餐、午餐午休 |  |
| 14:00~14:29 | 30 | 静默工作 | [季度总结报告](#20240428140000) |
| 14:30~14:59 | 30 | 静默工作 | [debug-nodejs fs读写同一个文件的内容混乱。](#20240428143000) |
| 15:00~15:59 | 60 | 休整 |  |
| 16:00~16:59 | 60 | 静默工作 | [填写term metadata的readme字段，增加成员无意识行为的特征](#20240428160000) |
| 17:00~18:59 | 120 | 晚餐 |  |
| 19:00~19:59 | 60 | 讨论、整理提交 |  |

模版一采用静默工作方式。  
希望讨论的提纲发到 [huangyg@mars22.com](mailto:huangyg@mars22.com)，通常安排在后面某天的早餐（5:15~5:59）或会议时间（6:00~6:45）。


---
<a id="index"></a>
- 07:45	[月份总结报告](#20240428074500)  
- 09:30	[试用term新结构，根据问题更新设计。](#20240428093000)  
- 14:00	[季度总结报告](#20240428140000)  
- 14:30	[debug-nodejs fs读写同一个文件的内容混乱。](#20240428143000)  
- 16:00	[填写term metadata的readme字段，增加成员无意识行为的特征](#20240428160000)  

---


[top](#top) | [index](#index)
<a id="20240428074500"></a>
## 7:45~8:44
月份总结报告

月份总结范例
```
三月份

日平均值，和二月对比：
热量1896.56千卡，+2.17千卡；
蛋白质76.52克，-0.28克；（RNI：65）
脂肪59.17克，+5.6克；
碳水270.47克，-18.46克；
钠2.15克，+0.14克；
膳食纤维33.96克，-1.18克；（AI：25~30）
钙1.38克，+0.15克；（RNI：0.8）
水2598.34ml ​​​，-145.12ml。

脂肪供能28.08%%（AMDR：20~30%） 
碳水供能57.04%（AMDR：50~65%）
蛋白质供能16.14%（AMDR：10~15%）
膳食纤维供能3.58%
```

季度总结范例
```
一季度

日平均值，和去年四季度对比：
热量1922.30千卡，+83.61千卡；
蛋白质81.86克，-3.5克；（RNI：65）
脂肪55.81克，+3.64克；
碳水281.98克，+20.85克；
钠2.13克，-0.15克；
膳食纤维35.11克，-0.3克；（AI：25~30）
钙1.31克，+0.1克；（RNI：0.8）
水2634.08ml ​​​，+263.77ml。

脂肪供能26.13%（AMDR：20~30%） 
碳水供能58.68%（AMDR：50~65%）
蛋白质供能17.03%（AMDR：10~15%）
膳食纤维供能3.65%
```

- 因为全局变量使用太多，化了不少时间适应。
- 建立了foodmonthreport() 基本框架。在原模版上增加去年同期的对比，把月度报告的第一行热量算出来了。
    - 有可能做所有营养成分对比。
- 还需要60时间片完成余下部分。

执行结果：
```
D:\huangyg\git\raw>node raw 202404
>> 脂肪供能25.86%  碳水供能57.39%  蛋白质供能17.86% <<
名称            总数量          日均    单位    NRV(%)
番茄红素        58.68           2.10    mg      0.00
灰分            15.41           0.55    g       0.00
硅              56.00           2.00    mg      0.00
叶黄素          7.00            0.25    mg      0.00
硼              4.20            0.15    mg      0.00
钒              280.00          10.00   μg      0.00
氯              1.96            0.07    g       3.00
胆固醇          4.33            0.15    g       51.61
磷              14.58           0.52    g       69.54
胡萝卜素        33.93           1.21    mg      79.87
钠              54.38           1.94    g       90.39
脂肪            1532.90         54.75   g       93.87
碳水化合物      7653.00         273.32  g       95.49
镁              9.75            0.35    g       96.64
生物素          840.00          30.00   μg      100.00
钼              1.26            0.04    mg      100.00
碘              4.22            0.15    mg      100.42
热量            53338.87        1904.96 kcal    102.49
水              68878.50        2459.95 ml      123.00
钾              78.24           2.79    g       127.89
铬              1.26            0.04    mg      129.00
膳食纤维        971.88          34.71   g       131.00
钙              38.08           1.36    g       138.35
蛋白质          2382.17         85.08   g       143.55
铁              556.07          19.86   mg      161.15
锰              109.45          3.91    mg      161.59
锌              520.01          18.57   mg      165.92
VB3(烟酸)       745.07          26.61   mg      176.82
VB1(硫胺素)     3.77            0.13    g       179.76
铜              47.07           1.68    mg      179.76
VE(生育酚)      1.24            0.04    g       209.57
VB5(泛酸)       293.43          10.48   mg      209.59
VB2(核黄素)     94.01           3.36    mg      241.15
VB9(叶酸)       18.39           0.66    mg      251.94
VB6(吡哆素)     116.78          4.17    mg      254.76
VA(视黄醇等)    65.89           2.35    mg      268.19
VD3(胆钙化醇)   1.70            0.06    mg      303.92
VK(凝血维生素)  7.19            0.26    mg      307.92
VC(抗坏血酸)    10.83           0.39    g       439.09
硒              7.60            0.27    mg      493.34
VB12(钴胺素)    732.77          26.17   μg      1090.94

20240401 ~ 20240500 : 28 days.

---
月度报告
四月份

日平均值，和三月份、去年四月份对比:
热量1904.96千卡， +8.40、+146.67千卡；

health/heartrate.R文件已被保存。在R环境运行 source("D:/huangyg/git/raw/health/heartrate.R",encoding = "UTF-8")
health/sleep.R文件已被保存。在R环境运行 source("D:/huangyg/git/raw/health/sleep.R",encoding = "UTF-8")
health/weight.R文件已被保存。在R环境运行 source("D:/huangyg/git/raw/health/weight.R",encoding = "UTF-8")
```


[top](#top) | [index](#index)
<a id="20240428093000"></a>
##  9:30~10:59
试用term新结构，根据问题更新设计。

- 选择一个termset.01e1c775，先生成view，再根据它编辑新的term temp metadata:
```
D:\huangyg\git\PSMD\src>node term termset 01e1c775
../view/termset.01e1c775.md文件更新，内容如下:
1. 由deployer书面提交即生效。
2. p=20，p%=20%。
3. 由director表决按一人一票表决，超过80%出席会议有效，赞成票超过超过三分之二为通过。

---

1. readme:
2. readme:
3. readme:

---
```
- 这个结构中，自修订条款“由deployer书面提交即生效。”还是应该作为单独条款。
- 而另外增加一层结构定义“p=20，p%=20%”由自修订条款修订。在这层结构中，自修订条款以termid被引用，而不是text字段。

有两种解决方案：

### 方案一：强化新term

- 在新term基础上，
- 新增body字段，作为高于subterm自条款一级的正文。用termid引用但是不增加sortid，view中也不增加prefix。
- 废弃termset。

根据termset.01e1c775编辑的范例：
```
name: 调整分配主比例
id: 1
interface:
  entity:
    '1': deployer
    '2': director
  asset:
    '1': p
text: |
body: 
  64eb9304:
    upgradeby: 64eb9304
    map:
      entity:
        '1': 1
subterm:
  - sortid: 1
    type: term
    id: bba7c6f1
    upgradeby: 64eb9304
    path: PSMD/data/term.bba7c6f1.yaml
    map:
      asset:
        '1': 1
  - sortid: 2
    type: term
    id: 177700d4
    upgradeby: 64eb9304
    path: PSMD/data/term.177700d4.yaml
    map:
      entity:
        '1': 2
readme: |
depend:
  errorid:
    percent:
    text: | 
together:
  errorid:
    percent:
    text: |
effect:
  errorid:
    percent:
    text: |
```

### 方案二：保留termset

- 在termset中增加body字段，表示termset的正文，不增加sortid和prefix。
- 在termset中取消path字段。
- 在termset中effect基础上，增加depend togetther 字段。
- 新term结构中可以去掉subterm字段。

详细方案在/PSMD/data/README.md


[top](#top) | [index](#index)
<a id="20240428140000"></a>
## 14:00~14:29
季度总结报告

- 继续完成月份总结报告。执行结果：
```
D:\huangyg\git\raw>node raw 202404
......
---
月度报告
四月份

日平均值，和三月份、去年四月份对比:
热量1904.91kcal， +8.35、+146.62kcal；
蛋白质85.05g， +7.90、+3.42g；
脂肪54.72g， -4.45、+5.98g；
碳水化合物273.40g， +2.93、+24.93g；
钠1.94g， -0.20、+0.07g；
膳食纤维34.74g， +0.78、+0.71g；
钙1.36g， -0.02、+0.35g；
水2468.86ml， -129.48、+385.34ml；

脂肪供能25.85% （AMDR：20~30%）
碳水化合物供能57.41% （AMDR：50~65%）
蛋白质供能17.86% （AMDR：10~15%）
膳食纤维供能3.65%
```

- 完成季度总结报告。执行结果：
```
D:\huangyg\git\raw>node raw 202403
......
---
季度报告
一季度

日平均值，和四季度、去年一季度对比:
热量1922.30kcal， +85.39、-244.03kcal；
蛋白质82.07g， -3.30、-24.14g；
脂肪55.81g， +3.68、-17.93g；
碳水化合物281.98g， +21.21、+14.63g；
钠2.13g， -0.15、+0.59g；
膳食纤维35.11g， -0.32、+8.71g；
钙1.31g， +0.10、-0.08g；
水2634.08ml， +265.66、+645.56ml；

脂肪供能26.13% （AMDR：20~30%）
碳水化合物供能58.68% （AMDR：50~65%）
蛋白质供能17.08% （AMDR：10~15%）
膳食纤维供能3.65%
```


[top](#top) | [index](#index)
<a id="20240428143000"></a>
## 14:30~14:59
debug-nodejs fs读写同一个文件的内容混乱

- 在 \ego\task\task.js drafttotask(date)中从draft收集log，写回task metadata文件的功能。在node task 1参数下调用。
- 因为alltask metadata文件结构修改过，需要微调：
    - alltask.task  -> alltask.tasklist
- 以前缀 test. 复制一批task metadata文件，作为测试用。
    - 测试文件加上log字段。
- 把写回语句从fs.writeFile() 改为writeFileSync() 运行正常。

[top](#top) | [index](#index)
<a id="20240428160000"></a>
## 16:00~16:59
填写term metadata的readme字段，增加成员无意识行为的特征

- 有些readme增加得勉强。
- 先尽量填写，有真实体会再重新整理需求。
- 按文件名排序，填写到 term.5c7d5a18
